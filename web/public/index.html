<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo lector de facturas</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f5f6fa; color: #2c3e50; }
    main { max-width: 720px; margin: 0 auto; background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 4px 18px rgba(0,0,0,0.08); }
    h1 { margin-top: 0; }
    .card { margin-top: 16px; padding: 16px; background: #f0f4ff; border: 1px solid #d6e0ff; border-radius: 6px; }
    .result { white-space: pre-wrap; font-family: 'SFMono-Regular', Menlo, Consolas, monospace; background: #0b1021; color: #e6edf3; padding: 16px; border-radius: 6px; overflow-x: auto; }
    .status { margin-top: 12px; font-weight: bold; }
    label { display: block; margin-bottom: 8px; }
    input[type="file"] { margin-bottom: 12px; }
    button { padding: 10px 18px; border: none; border-radius: 4px; background: #2d7ff9; color: #fff; cursor: pointer; font-size: 15px; }
    button:disabled { background: #9bb8f5; cursor: not-allowed; }
  </style>
</head>
<body>
  <main>
    <h1>Sube una factura PDF</h1>
    <p>La API leerá el PDF y devolverá el JSON con proveedor, número, fecha e ítems.</p>
    <div class="card">
      <form id="upload-form">
        <label for="invoice">Archivo PDF</label>
        <input type="file" id="invoice" name="invoice" accept="application/pdf" required>
        <button type="submit">Procesar factura</button>
      </form>
      <div class="status" id="status"></div>
    </div>
    <h2>Resultado</h2>
    <pre class="result" id="result">(esperando archivo...)</pre>
  </main>
  <script>
    const form = document.getElementById('upload-form');
    const statusEl = document.getElementById('status');
    const resultEl = document.getElementById('result');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      const fileInput = document.getElementById('invoice');
      if (!fileInput.files.length) {
        statusEl.textContent = 'Selecciona un PDF.';
        return;
      }

      const formData = new FormData();
      formData.append('invoice', fileInput.files[0]);

      statusEl.textContent = 'Procesando factura...';
      resultEl.textContent = '';

      try {
        const response = await fetch('/api/parse', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (!response.ok) {
          statusEl.textContent = data.error || 'No se pudo procesar la factura.';
          resultEl.textContent = '';
          return;
        }

        statusEl.textContent = 'Factura procesada correctamente';
        resultEl.textContent = JSON.stringify(data.invoice, null, 2);
      } catch (error) {
        statusEl.textContent = 'Error de red o servidor';
        resultEl.textContent = '';
      }
    });
  </script>
</body>
</html>
